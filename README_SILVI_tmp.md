# Workflow

## R package dependencies:

tidyverse
stringr

## General execution process

The scripts Fire_classI.R and Fire_classII.R contain the commands to apply analysis steps to class I or class II epitope binding prediction data, respectively. Path to input files should be edited by the user in Fire_classI.R or Fire_classII.R. We recommend loading the script files in Rstudio (link to rstudio) and execute each step sequentially.

##Step1

### Input

#### FOR CLASS I:
First, users must provide results for proteins of interest generated by epitope binding programs. Submit fasta sequences of proteins to the following online predictors. Currently, the script only accept results from 9-mer epitopes for class I alleles. 
links to online predictor:
(iedb)[http://tools.iedb.org/mhci/]
(NetMHCpan)[http://www.cbs.dtu.dk/services/NetMHCpan/]
(Epitope Prediction)[http://www.syfpeithi.de/bin/MHCServer.dll/EpitopePrediction.htm]

Allele restriction: allele names are accepted in the following formats: HLA-Ai\*02:01 / HLA-A0201 / . 
HLA-class I alleles are grouped in 11 allele supertypes to enable the comparison between predictors. In default settings, a worldwide HLA coverage is foreseen and IEDB-classI predictions includes 36 alleles, SYFPEITHI includes 22, and NetMHCpan includes 11 allele supertype representatives.  
[table map_allele_supertypes]

If more alleles were used to perform the predictions, change this file at /data/ and add desired allele in the correct supertype.
  (.txt allele file to upload online in IEDB and NetMCHpan)
Format your results files as csv
4 columns: allele,peptides,seq_num,score
comma separated
Files name MUST be formated as: proteincode_predictorcode.csv e.g. “kinase_iedb.csv” “kinase_netmhcpan.csv” and “kinase_syfpeithi.csv”
Move your files in a directory named data created in the working directory
Execute the first lines of Fire_classI.R:
[box with code]
SILVI will check if files are correctly formatted, compare peptides, alleles and predictors. It will generate one single dataframe with peptides which are 100% identical among all seq_num, and peptides predicted by at least 2 predictors.
FOR CLASS II:
Similarly, users should obtain epitope HLA-binding prediction results from online algorithms. Currently, the script only accepts results from 15-mer epitopes for Class II alleles.
links to online predictor:
http://tools.iedb.org/mhcii/
http://www.cbs.dtu.dk/services/NetMHCIIpan/
Allele restriction: allele names are accepted in the following formats: DRB1\*02:01 / DRB1_0201 / . HLA-class II alleles are directly compared among predictors. In default settings, a worldwide HLA coverage is foreseen and includes 21 class II alleles, the same exist in IEDB class II and NetMHCIIpan predictors.   
Format your results files as csv
4 columns: allele,seq_num,full_peptide,rank,core,ic50
semi-colon separated
Files name MUST be formated as: proteincode_predictorcode.csv
Move your files in a directory named data created in the working directory
Execute the first lines of Fire_classII.R:
[]
SILVI will check if files are correctly formatted, compare peptides, alleles and predictors. It will generate one single dataframe with peptides which are 100% identical among all seq_num, and peptides predicted by at least 2 predictors.
Intermediate Output
FOR CLASS I, the first step of the script output the following files:
1_common_I.csv Formatted predictions for class I allele supertypes in a csv file.
1_blast_me.fasta Fasta file of common peptide sequences to blast again host proteome.
FOR CLASS II, the first step of the script output the following files:
1_common_II.csv Formatted predictions for class II supertype in a csv file.
1_blast_me.fasta Fasta file of peptide sequences to blast again host proteome.
At this point, users must open an online blastp window (link) and upload the generated 1_blast_me.fasta file. In this page, select the host’s RefSeq proteome, perform the search with default parameters, that will be automatically changed to short-blastp parameters.
Download blastp alignment results in Text (.txt). Once download is complete, move alignment file to /data in working directory.
Step2
FOR CLASS I and CLASS II:
Users must introduce file name in the string or change the file name to default name “blast_results.txt”.
Execute the last lines of Fire_classI.R or Fire_classII.R:
[code]
SILVI will generate 2 new files:
2_common_I and 3_blastmismatches_I 
or 2_common_II and 3_blastmismatches_II
The file 3_blast_mismatches_I contains the following columns:
“peptide","middle","middle2","subject","m_1","m_2","m_3","m_4","m_5","m_6","m_7","m_8","m_9","protein","supertype","predictor","seq_num","score","blast_info","file"
NEW???:
“peptide","protein","supertype","predictor", “promiscuity”, "seq_num","IC50_I", “IC50_N”, “totalMM”, “anchorMM”, "blast_info","file"

Users can now select the best epitopes according to any of the relevant variables in the final output table.


